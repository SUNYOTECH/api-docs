<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>API Reference</title>

    <link href="stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="javascripts/all.js" type="text/javascript"></script>

      <script>
        $(function() {
          setupLanguages(["javascript","coffeescript"]);
        });
      </script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-60548656-1', 'docs.stampery.com');
      ga('set', 'contentGroup1', 'My Group Name'); 
      ga('send', 'pageview');

    </script>
  </head>

  <body class="index">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <div class="logo_container">
        <img src="images/logo.svg" />
      </div>
        <div class="lang-selector">
              <a href="#" data-language-name="javascript">javascript</a>
              <a href="#" data-language-name="coffeescript">coffeescript</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='https://api-dashboard.stampery.com' target="_blank" class='signup'>Sign up to Stampery</a></li>
            <li><a href='http://github.com/tripit/slate'>Documentation Powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="introduction">Introduction</h1>

<blockquote>
<p>You can get the latest version of <strong>Stampery API</strong> wrapper for your preferred language:</p>

<ul>
<li>Node.js → <a href="https://github.com/stampery/node">https://github.com/stampery/node</a></li>
<li>PHP     → <em>Coming soon</em></li>
<li>Python  → <em>Coming soon</em></li>
<li>Elixir  → <em>Coming soon</em></li>
</ul>
</blockquote>

<p>This is the documentation for version 3 of the <strong>Stampery public API</strong>.</p>

<p>We have just released a Node.js language binding, but PHP, Python, Elixir and other ones are coming soon!</p>

<p>You can view code examples in the dark area to the right, and switch the programming language of the examples with the tabs in the top right.</p>

<h1 id="authentication">Authentication</h1>
<pre class="highlight javascript"><code><span class="nx">stampery</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Stampery</span><span class="p">(</span><span class="s1">'367c6ec2-5791-4cf5-8094-4bae00c639b4'</span><span class="p">);</span>
</code></pre>
<pre class="highlight coffeescript"><code><span class="nx">stampery</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Stampery</span> <span class="s">'367c6ec2-5791-4cf5-8094-4bae00c639b4'</span>
</code></pre>

<p>Authentication is performed by using app-specific <strong>secret tokens</strong>.</p>

<p>You can generate your own secret tokens from the <a href="https://api-dashboard.stampery.com">API dashboard</a>.</p>

<h1 id="stamping">Stamping</h1>

<h2 id="stamping-a-hash">Stamping a hash</h2>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">digest</span> <span class="o">=</span> <span class="s1">'0989551C2CCE109F40BE2C8AD711E23A\
539445C93547DFC13D25F9E8147886B8\
D0E71A16FF4DED1CB4BC6AC2E4BBB572\
2F0996B24F79FC849531FE70BB2DE800'</span><span class="p">;</span>

<span class="nx">stampery</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'proof'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">hash</span><span class="p">,</span> <span class="nx">proof</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Received proof for hash '</span> <span class="o">+</span> <span class="nx">hash</span><span class="p">,</span> <span class="nx">proof</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">stampery</span><span class="p">.</span><span class="nx">hash</span><span class="p">(</span><span class="nx">digest</span><span class="p">);</span>
</code></pre>
<pre class="highlight coffeescript"><code><span class="nx">digest</span> <span class="o">=</span> <span class="s">'0989551C2CCE109F40BE2C8AD711E23A539445C93547DFC13D25F9E8147886B8D0E71A16FF4DED1CB4BC6AC2E4BBB5722F0996B24F79FC849531FE70BB2DE800'</span>

<span class="nx">stampery</span><span class="p">.</span><span class="na">on</span> <span class="s">'proof'</span><span class="p">,</span> <span class="p">(</span><span class="nx">hash</span><span class="p">,</span> <span class="nx">proof</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">console</span><span class="p">.</span><span class="na">log</span> <span class="s">"Received proof for hash </span><span class="si">#{</span><span class="nx">hash</span><span class="si">}</span><span class="s">"</span><span class="p">,</span> <span class="nx">proof</span>

<span class="nx">stampery</span><span class="p">.</span><span class="na">stamp</span> <span class="nx">digest</span>
</code></pre>

<p>Our API is capable of stamping <strong>SHA3-512</strong> hashes directly.</p>

<aside class="info"><strong>SHA3</strong>, a subset of <strong>Keccak</strong>, is the last version of the SHA family of cryptographic hash functions.<br />Our API uses a <strong>512</strong> bits output size, so the hexadecimal digest of all hashes will have a length of 128 characters.</aside>

<p>For stamping a SHA3-512 hash, you only have to make a call to the <code class="prettyprint">stamp</code> method of our API, as seen in the examples to the right.</p>

<h2 id="stamping-a-file">Stamping a file</h2>
<pre class="highlight javascript"><code><span class="nx">stampery</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'proof'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">hash</span><span class="p">,</span> <span class="nx">proof</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Received proof for hash '</span> <span class="o">+</span> <span class="nx">hash</span><span class="p">,</span> <span class="nx">proof</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="s1">'/etc/hosts'</span><span class="p">,</span> <span class="s1">'utf8'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">stampery</span><span class="p">.</span><span class="nx">hash</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">stampery</span><span class="p">.</span><span class="nx">stamp</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
<pre class="highlight coffeescript"><code><span class="nx">stampery</span><span class="p">.</span><span class="na">on</span> <span class="s">'proof'</span><span class="p">,</span> <span class="p">(</span><span class="nx">hash</span><span class="p">,</span> <span class="nx">proof</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">console</span><span class="p">.</span><span class="na">log</span> <span class="s">"Received proof for hash </span><span class="si">#{</span><span class="nx">hash</span><span class="si">}</span><span class="s">"</span><span class="p">,</span> <span class="nx">proof</span>

<span class="nx">fs</span><span class="p">.</span><span class="na">readFile</span> <span class="s">'/etc/hosts'</span><span class="p">,</span> <span class="s">'utf8'</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">stampery</span><span class="p">.</span><span class="na">hash</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">stampery</span><span class="p">.</span><span class="na">stamp</span>
</code></pre>

<p>Stamping a file is as easy as obtaining its <strong>SHA3-512</strong> hash and then stamping the hash as explained in the previous section.</p>

<p>For your convenience, all our language bindings include a function for hashing files as seen in the examples to the right.</p>

<h1 id="proofs">Proofs</h1>

<h2 id="proof-format">Proof format</h2>

<p>This is the structure of a proof:</p>

<aside class="info">[v, s, r, [c, t]]</aside>

<p>Where <code class="prettyprint">v</code>, <code class="prettyprint">s</code>, <code class="prettyprint">r</code>, <code class="prettyprint">c</code> and <code class="prettyprint">t</code> are:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Description</th>
<th>Value type</th>
</tr>
</thead><tbody>
<tr>
<td>v</td>
<td>BTA version used.</td>
<td>Integer(1)</td>
</tr>
<tr>
<td>s</td>
<td>Merkle siblings.</td>
<td>Array</td>
</tr>
<tr>
<td>r</td>
<td>Merkle root.</td>
<td>String(128)</td>
</tr>
<tr>
<td>c</td>
<td>Chain code.</td>
<td>Integer(1)</td>
</tr>
<tr>
<td>t</td>
<td>Transaction ID (txid)</td>
<td>String(64)</td>
</tr>
</tbody></table>

<p>Valid chain codes for <code class="prettyprint">c</code> are:</p>

<table><thead>
<tr>
<th>Value</th>
<th>Chain</th>
</tr>
</thead><tbody>
<tr>
<td>1</td>
<td>Bitcoin livenet</td>
</tr>
<tr>
<td>2</td>
<td>Ethererum livenet</td>
</tr>
</tbody></table>

<h2 id="retrieving-missed-proofs">Retrieving missed proofs</h2>
<pre class="highlight javascript"><code><span class="nx">stampery</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'proof'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">hash</span><span class="p">,</span> <span class="nx">proof</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Received missed proof for hash '</span> <span class="o">+</span> <span class="nx">hash</span><span class="p">,</span> <span class="nx">proof</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">stampery</span><span class="p">.</span><span class="nx">receiveMissedProofs</span><span class="p">();</span>
</code></pre>
<pre class="highlight coffeescript"><code><span class="nx">stampery</span><span class="p">.</span><span class="na">on</span> <span class="s">'proof'</span><span class="p">,</span> <span class="p">(</span><span class="nx">hash</span><span class="p">,</span> <span class="nx">proof</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">console</span><span class="p">.</span><span class="na">log</span> <span class="s">"Received missed proof for hash </span><span class="si">#{</span><span class="nx">hash</span><span class="si">}</span><span class="s">"</span><span class="p">,</span> <span class="nx">proof</span>

<span class="nx">stampery</span><span class="p">.</span><span class="na">receiveMissedProofs</span><span class="p">()</span>
</code></pre>

<p>If you make a stamp and for some reason disconnect from our service right after, you will miss the proof.</p>

<p>Don&rsquo;t worry, <strong>missed proofs are queued in our servers for 24h</strong>, and you can retrieve them by making a simple call to the <code class="prettyprint">receiveMissedProofs</code> method.</p>

<h2 id="checking-a-proof-proving">Checking a proof (proving)</h2>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">mix</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">b</span> <span class="o">&gt;</span> <span class="nx">a</span><span class="p">){</span>
    <span class="p">[</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">b</span><span class="p">,</span> <span class="nx">a</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="nx">sha3</span> <span class="o">=</span> <span class="k">new</span> <span class="p">(</span><span class="nx">SHA3</span><span class="p">.</span><span class="nx">SHA3Hash</span><span class="p">)();</span>
  <span class="nx">sha3</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">sha3</span><span class="p">.</span><span class="nx">digest</span><span class="p">(</span><span class="s1">'hex'</span><span class="p">).</span><span class="nx">toUpperCase</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">prove</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">hash</span><span class="p">,</span> <span class="nx">siblings</span><span class="p">,</span> <span class="nx">root</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">siblings</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">head</span> <span class="o">=</span> <span class="nx">siblings</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="nx">tail</span> <span class="o">=</span> <span class="nx">siblings</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="nx">hash</span> <span class="o">=</span> <span class="nx">mix</span><span class="p">(</span><span class="nx">hash</span><span class="p">,</span> <span class="nx">head</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">prove</span><span class="p">(</span><span class="nx">hash</span><span class="p">,</span> <span class="nx">tail</span><span class="p">,</span> <span class="nx">root</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">hash</span> <span class="o">==</span> <span class="nx">root</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">prove</span><span class="p">(</span><span class="nx">digest</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">r</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="s1">'Valid!'</span> <span class="o">&amp;&amp;</span> <span class="s1">'Wrong!'</span><span class="p">);</span>
</code></pre>
<pre class="highlight coffeescript"><code><span class="nx">mix</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="k">if</span> <span class="nx">b</span> <span class="o">&gt;</span> <span class="nx">a</span>
    <span class="p">[</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">b</span><span class="p">,</span> <span class="nx">a</span><span class="p">]</span>
  <span class="nx">sha3</span> <span class="o">=</span> <span class="k">new</span> <span class="p">(</span><span class="nx">SHA3</span><span class="p">.</span><span class="na">SHA3Hash</span><span class="p">)</span>
  <span class="nx">sha3</span><span class="p">.</span><span class="na">update</span> <span class="nx">data</span>
  <span class="nx">sha3</span><span class="p">.</span><span class="na">digest</span><span class="p">(</span><span class="s">'hex'</span><span class="p">).</span><span class="na">toUpperCase</span><span class="p">()</span>

<span class="nx">prove</span> <span class="o">=</span> <span class="p">(</span><span class="nx">hash</span><span class="p">,</span> <span class="nx">siblings</span><span class="p">,</span> <span class="nx">root</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="k">if</span> <span class="nx">siblings</span><span class="p">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="nx">head</span> <span class="o">=</span> <span class="nx">siblings</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nx">tail</span> <span class="o">=</span> <span class="nx">siblings</span><span class="p">.</span><span class="na">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="nx">hash</span> <span class="o">=</span> <span class="nx">mix</span><span class="p">(</span><span class="nx">hash</span><span class="p">,</span> <span class="nx">head</span><span class="p">)</span>
    <span class="nx">prove</span> <span class="nx">hash</span><span class="p">,</span> <span class="nx">tail</span><span class="p">,</span> <span class="nx">root</span>
  <span class="k">else</span>
    <span class="nx">hash</span> <span class="o">==</span> <span class="nx">root</span>

<span class="nx">console</span><span class="p">.</span><span class="na">log</span> <span class="nx">prove</span><span class="p">(</span><span class="nx">digest</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">r</span><span class="p">)</span> <span class="o">and</span> <span class="s">'Valid!'</span> <span class="o">and</span> <span class="s">'Wrong!'</span>
</code></pre>

<p>We call <strong>proving</strong> to the process of verifying a proof is valid and therefore demonstrating a hash or file has been undoubtfully embedded in the blockchain and it has not been tampered since then.</p>

<p>Proofs are independently verifiable by everyone in possesion of the hash or file and the proof itself.</p>

<p>For Stampery proofs made with the current version 5 of our BTA platform, the process of proving is made like this:</p>

<ol>
<li>Take the hash</li>
<li>Take first element in the Merkle siblings list <code class="prettyprint">s[0]</code></li>
<li>Concatenate both, putting the biggest of them in front</li>
<li>Hash the resulting string with <code class="prettyprint">SHA3-512</code></li>
<li>Take the resulting hash and the next element in the Merkle siblings list, concatenate like before and hash the resulting string</li>
<li>Repeat same process until there are no elements left in the Merkle siblings list</li>
<li>Check the resuting string matches the Merkle root of the proof, <code class="prettyprint">r</code></li>
<li>Take the transaction ID, <code class="prettyprint">t</code>, and paste in your favorite Bitcoin/Ethereum chain explorer</li>
<li>Check that the Merkle root, <code class="prettyprint">r</code>, matches the tail of the data embedded in the transaction</li>
</ol>

<p>If the checks in steps <strong>7</strong> and <strong>9</strong> pass, then you have proved that the proof is OK and the hash or file has not been tampered.</p>

          
      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="javascript">javascript</a>
                <a href="#" data-language-name="coffeescript">coffeescript</a>
          </div>
      </div>
    </div>
  </body>
</html>
